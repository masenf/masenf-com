<!--
:author masen
:title down the puppet hole
:published 1341293302
:modified 1341293302
:permalink 15
:slug down-the-puppet-hole
-->

In my post last week, I was discussing some DNS issues we were experiencing while deploying puppet to some workstations in the ResTek office. Unfortunately, after the issue with the faulty init.d start scripts was resolved, half of the machines were still not 'calling in' to the puppetmaster. I should mention at this point that the current version of puppet in the Ubuntu repositories is 2.7.11;&nbsp;naively, this is the version that we are running.<br><br>After sifting through bug reports and working on other things, Brenan showed me a bug report affecting our version of puppet, which was&nbsp;supposedly&nbsp;fixed in 2.7.17. That bug report however is so&nbsp;elusive that I couldn't even find it again to link from here!&nbsp;<br><br>First, we wanted to determine if the latest version of puppet would even resolve our issues, then we needed to come up with a way to deploy it.&nbsp;<br><br>Initially, we were going to use the prebuilt apt.puppetlabs repositories, but since this isn't the first bug we've had to fix in our Ubuntu&nbsp;packages (a story for another post)&nbsp;we decided it would be worthwhile to set up our own internal APT repository for all custom built packages. So we backported puppet 2.7.17 on Ubuntu 12.04 and tested against the previously buggy behavior to find the problem resolved. Yay!<br><br>Now I'm not happy to admit it, but before this package, we've built and deployed 6 or 7 other custom built binary packages which were deficient as-built&nbsp;in the Ubuntu repos. Our primary method for deployment was to copy the .deb packages to the puppetmaster server and use a File resource to copy them to the host and a Package { ...: provider =&gt; dpkg } to install them. This seems like a cheap easy solution at first, but it has a variety of interesting issues: packages install over and over again, custom packages get overwritten by repo packages during upgrades, etc. Long story short, the dpkg configuration was bringing suffering&nbsp;to my usual administration contentment. Digression aside, we resolved to create our own APT repository.<br><br>Given that APT was designed by the debian folks, the only suggestion I found for hosting an APT repo easily and simply on FreeBSD (our primary server environment) was to use NFS and remotely manage the repo on a debian box. Okay, but to me that sounded like more trouble than it was worth. Nearly all the debian tutorials were using a program made for APT repo management, reprepro (<a target="_blank" rel="nofollow" href="http://mirrorer.alioth.debian.org/">http://mirrorer.alioth.debian.org/</a>&nbsp;-- formerly mirrorer). I cloned the git repository and starting hacking at the code to make it run on FreeBSD. After a few dependencies were satisfied